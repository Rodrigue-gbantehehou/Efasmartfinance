{% extends 'admin/base.html.twig' %}

{% block title %}Plateforme de Revenue — Finance{% endblock %}

{% block contentadmin %}
<div class="min-h-screen bg-green-50 p-6 lg:p-8">
    <!-- Header Sophistiqué -->
    <div class="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-6">
        <div>
            <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-xl bg-emerald-600 text-white flex items-center justify-center shadow-lg shadow-emerald-200">
                    <i class="fas fa-chart-line text-sm"></i>
                </div>
                <span class="text-xs font-bold text-emerald-600 uppercase tracking-widest">Revenue Analytics</span>
            </div>
            <h1 class="text-3xl font-bold font-poppins text-gray-900 tracking-tight">Tableau de bord des Commissions</h1>
            <p class="text-gray-600 font-medium mt-1">Surveillance des flux de services et de la rentabilité opérationnelle.</p>
        </div>
        <div class="flex items-center gap-4">
            <div class="h-14 px-6 bg-white border border-gray-100 rounded-2xl flex items-center gap-3 shadow-sm">
                <span class="text-xs font-bold text-gray-600 uppercase tracking-widest">Actualisé le</span>
                <span class="text-sm font-bold text-gray-900">{{ currentDate|date('d M Y, H:i') }}</span>
            </div>
        </div>
    </div>

    <!-- Triplets de Performance -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
        <!-- Journalier -->
        <div class="group relative bg-white rounded-[2.5rem] p-8 border border-gray-100 shadow-sm hover:shadow-xl transition-all overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-emerald-50 rounded-full -mr-16 -mt-16 group-hover:scale-110 transition-transform"></div>
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-8">
                    <div class="w-12 h-12 rounded-2xl bg-emerald-50 text-emerald-600 flex items-center justify-center">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] font-bold uppercase tracking-widest">Aujourd'hui</span>
                </div>
                <div>
                    <p class="text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-1">Total Journalier</p>
                    <p class="text-4xl font-black font-poppins text-gray-900 leading-none">
                        {{ dailyFees|reduce((total, fee) => total + fee.total, 0)|number_format(0, ',', ' ') }}<span class="text-sm ml-2 font-bold text-gray-600">FCFA</span>
                    </p>
                </div>
                <div class="mt-8 space-y-3">
                    {% for fee in dailyFees|slice(0, 3) %}
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600 font-medium">{{ fee.type|trans }}</span>
                            <span class="text-gray-900 font-bold">+{{ fee.total|number_format(0, ',', ' ') }}</span>
                        </div>
                    {% endfor %}
                    {% if dailyFees|length > 3 %}
                        <p class="text-[10px] text-emerald-600 font-bold uppercase mt-2">+ {{ dailyFees|length - 3 }} autres sources</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Mensuel -->
        <div class="group relative bg-[#1e293b] rounded-[2.5rem] p-8 text-white shadow-2xl hover:shadow-emerald-900/20 transition-all overflow-hidden border border-white/5">
            <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16 group-hover:scale-110 transition-transform"></div>
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-8">
                    <div class="w-12 h-12 rounded-2xl bg-white/10 text-emerald-400 flex items-center justify-center">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <span class="px-3 py-1 bg-white/10 text-white rounded-lg text-[10px] font-bold uppercase tracking-widest">Ce mois</span>
                </div>
                <div>
                    <p class="text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-1">Performance Mensuelle</p>
                    <p class="text-4xl font-black font-poppins text-white leading-none">
                        {{ monthlyFees|reduce((total, fee) => total + fee.total, 0)|number_format(0, ',', ' ') }}<span class="text-sm ml-2 font-bold text-gray-600">FCFA</span>
                    </p>
                </div>
                <div class="mt-8 space-y-3">
                     {% for fee in monthlyFees|slice(0, 3) %}
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600 font-medium">{{ fee.type|trans }}</span>
                            <span class="text-white font-bold">{{ fee.total|number_format(0, ',', ' ') }}</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Annuel -->
        <div class="group relative bg-white rounded-[2.5rem] p-8 border border-gray-100 shadow-sm transition-all overflow-hidden">
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-8">
                    <div class="w-12 h-12 rounded-2xl bg-amber-50 text-amber-600 flex items-center justify-center">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-lg text-[10px] font-bold uppercase tracking-widest">Année {{ currentDate|date('Y') }}</span>
                </div>
                <div>
                    <p class="text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-1">Volume de Revenue Annuel</p>
                    <p class="text-4xl font-black font-poppins text-gray-900 leading-none">
                        {{ annualFees|reduce((total, fee) => total + fee.total, 0)|number_format(0, ',', ' ') }}<span class="text-sm ml-2 font-bold text-gray-600">FCFA</span>
                    </p>
                </div>
                <div class="mt-8">
                    <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                        <div class="bg-amber-500 h-full w-[75%]"></div>
                    </div>
                    <p class="text-[10px] text-gray-600 font-bold uppercase mt-3">Projection: En hausse de 12%</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Table des Flux -->
    <div class="bg-white rounded-[2.5rem] border border-gray-100 shadow-sm overflow-hidden">
        <div class="p-8 border-b border-gray-50 flex items-center justify-between bg-gray-50/30">
            <div>
                <h3 class="text-xl font-bold text-gray-900 tracking-tight">Journal d'Audit des Frais</h3>
                <p class="text-xs font-bold text-gray-600 uppercase tracking-widest mt-1">Historique consolidé des prélèvements</p>
            </div>
            <button class="h-12 px-6 bg-white border border-gray-100 rounded-xl text-xs font-bold uppercase tracking-widest text-gray-600 hover:bg-gray-50 transition-all flex items-center gap-2">
                <i class="fas fa-download"></i> Rapport Global
            </button>
        </div>

        {% if monthlyFees is not empty %}
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-white border-b border-gray-50">
                        <th class="px-8 py-5 text-[10px] font-bold text-gray-600 uppercase tracking-widest">Type de Service</th>
                        <th class="px-8 py-5 text-[10px] font-bold text-gray-600 uppercase tracking-widest">Volume Mensuel</th>
                        <th class="px-8 py-5 text-[10px] font-bold text-gray-600 uppercase tracking-widest">Contribution (%)</th>
                        <th class="px-8 py-5 text-[10px] font-bold text-gray-600 uppercase tracking-widest font-center">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-50">
                    {% set totalMonthly = monthlyFees|reduce((total, fee) => total + fee.total, 0) %}
                    {% for fee in monthlyFees %}
                    <tr class="group hover:bg-emerald-50/30 transition-all duration-300">
                        <td class="px-8 py-6">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-xl bg-white border border-gray-100 flex items-center justify-center text-xs text-emerald-600 transition-all group-hover:border-emerald-200">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                </div>
                                <span class="font-bold text-gray-900 text-sm font-poppins">{{ fee.type|trans }}</span>
                            </div>
                        </td>
                        <td class="px-8 py-6 font-bold text-gray-900 text-sm">
                            {{ fee.total|number_format(0, ',', ' ') }} FCFA
                        </td>
                        <td class="px-8 py-6">
                            {% set pct = (fee.total / totalMonthly * 100)|round(1) %}
                            <div class="flex items-center gap-3">
                                <span class="text-xs font-bold text-emerald-600 w-10">{{ pct }}%</span>
                                <div class="h-1.5 w-32 bg-gray-100 rounded-full overflow-hidden">
                                    <div class="bg-emerald-500 h-full" style="width: {{ pct }}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-8 py-6">
                            <a href="#" class="h-10 w-10 rounded-xl bg-gray-50 text-gray-600 flex items-center justify-center hover:bg-emerald-600 hover:text-white transition-all shadow-sm">
                                <i class="fas fa-magnifying-glass text-xs"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="p-20 flex flex-col items-center justify-center text-center">
            <div class="w-24 h-24 rounded-[2rem] bg-gray-50 text-gray-200 flex items-center justify-center text-4xl mb-6">
                <i class="fas fa-piggy-bank"></i>
            </div>
            <h4 class="text-lg font-bold text-gray-900">Aucun revenu pour le moment</h4>
            <p class="text-gray-600 text-sm mt-2 max-w-xs">Les transactions de commission apparaîtront ici dès que les services seront sollicités.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap');
    .font-poppins { font-family: 'Poppins', sans-serif; }
</style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Automatic update logic if needed
    </script>
{% endblock %}
