{% extends 'admin/base.html.twig' %}

{% block title %}Facture {{ facture.numero }}{% endblock %}

{% block contentadmin %}
<div class="min-h-screen bg-green-50 from-slate-50 via-green-50/30 to-slate-100 font-poppins p-8">
    <div class="max-w-4xl mx-auto">
        
        {# Header #}
        <div class="mb-8">
            <a href="{{ path('admin_invoices') }}" class="inline-flex items-center gap-2 text-green-600 hover:text-green-700 font-semibold mb-4">
                ‚Üê Retour aux factures
            </a>
            <h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-green-800 mb-2">
                üìÑ Facture {{ facture.numero }}
            </h1>
            <p class="text-slate-600 text-lg">D√©tails complets de la facture</p>
        </div>

        {# Invoice Details Card #}
        <div class="bg-white rounded-3xl p-8 shadow-lg border-2 border-slate-100 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                {# Client Info #}
                <div>
                    <h2 class="text-xl font-bold text-slate-800 mb-4">üë§ Informations Client</h2>
                    {% if facture.client %}
                        <div class="space-y-2">
                            <div>
                                <span class="text-sm text-slate-500">Nom complet</span>
                                <div class="font-semibold text-slate-800">{{ facture.client.firstname }} {{ facture.client.lastname }}</div>
                            </div>
                            <div>
                                <span class="text-sm text-slate-500">Email</span>
                                <div class="font-semibold text-slate-800">{{ facture.client.email }}</div>
                            </div>
                            <div>
                                <span class="text-sm text-slate-500">T√©l√©phone</span>
                                <div class="font-semibold text-slate-800">{{ facture.client.phone|default('N/A') }}</div>
                            </div>
                        </div>
                    {% else %}
                        <p class="text-slate-400">Client non disponible</p>
                    {% endif %}
                </div>

                {# Invoice Info #}
                <div>
                    <h2 class="text-xl font-bold text-slate-800 mb-4">üìã Informations Facture</h2>
                    <div class="space-y-2">
                        <div>
                            <span class="text-sm text-slate-500">Num√©ro</span>
                            <div class="font-mono font-bold text-green-600">{{ facture.numero }}</div>
                        </div>
                        <div>
                            <span class="text-sm text-slate-500">Date d'√©mission</span>
                            <div class="font-semibold text-slate-800">{{ facture.dateEmission|date('d/m/Y') }}</div>
                        </div>
                        <div>
                            <span class="text-sm text-slate-500">Statut</span>
                            <div>
                                {% if facture.statut == 'payee' %}
                                    <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold">‚úì Pay√©e</span>
                                {% else %}
                                    <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-semibold">‚è≥ Impay√©e</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {# Description #}
            {% if facture.description %}
                <div class="mb-8 p-4 bg-slate-50 rounded-2xl">
                    <h3 class="text-sm font-bold text-slate-700 mb-2">Description</h3>
                    <p class="text-slate-600">{{ facture.description }}</p>
                </div>
            {% endif %}

            {# Amounts #}
            <div class="border-t-2 border-slate-100 pt-6">
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-600">Montant HT</span>
                        <span class="font-semibold text-slate-800">{{ facture.montantHT|number_format(2, ',', ' ') }} FCFA</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-600">TVA ({{ facture.tva }}%)</span>
                        <span class="font-semibold text-slate-800">{{ ((facture.montantTTC - facture.montantHT)|number_format(2, ',', ' ')) }} FCFA</span>
                    </div>
                    <div class="flex justify-between items-center pt-3 border-t-2 border-slate-200">
                        <span class="text-xl font-bold text-slate-800">Total TTC</span>
                        <span class="text-2xl font-black text-emerald-600">{{ facture.montantTTC|number_format(2, ',', ' ') }} FCFA</span>
                    </div>
                </div>
            </div>
        </div>

        {# Actions #}
        <div class="flex flex-wrap gap-4">
            <a href="{{ path('admin_invoice_download', {id: facture.id}) }}" 
               class="px-6 py-3 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 transition-colors font-semibold inline-flex items-center gap-2">
                ‚¨á T√©l√©charger PDF
            </a>
            
            {% if facture.client %}
                <form method="post" action="{{ path('admin_invoice_resend', {id: facture.id}) }}" class="inline">
                    <input type="hidden" name="_token" value="{{ csrf_token('resend' ~ facture.id) }}">
                    <button type="submit" 
                            onclick="return confirm('Voulez-vous vraiment renvoyer cette facture par email ?')"
                            class="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors font-semibold inline-flex items-center gap-2">
                        ‚úâÔ∏è Renvoyer par Email
                    </button>
                </form>
            {% endif %}
        </div>

    </div>
</div>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap');
    .font-poppins { font-family: 'Poppins', sans-serif; }
</style>
{% endblock %}
