{% extends 'dashboard/base.html.twig' %}

{% block title %}Gérer mon Code PIN — Efa Smart Finance{% endblock %}

{% block contentdashboard %}
<div class="min-h-screen bg-green-800 flex items-center justify-center p-4 font-poppins">
    <div class="max-w-4xl w-full">
        <div class="bg-white rounded-[2.5rem] shadow-sm border border-gray-100 overflow-hidden">
            <div class="md:flex">
                <!-- Left Info Section (Mobile Hidden or Top) -->
                <div class="hidden md:flex bg-green-800 p-10 md:w-1/3 text-white flex-col justify-between">
                    <div>
                        <div class="h-12 w-12 bg-white/10 rounded-xl flex items-center justify-center mb-6">
                            <i class="fas fa-shield-halved text-2xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold mb-4">Sécurité Active</h2>
                        <p class="text-green-100 text-sm leading-relaxed opacity-80">
                            Votre code PIN protège vos fonds et vos données personnelles contre tout accès non autorisé.
                        </p>
                    </div>

                    <div class="mt-12 space-y-4">
                        <div class="flex items-center gap-3 text-xs">
                            <i class="fas fa-check-circle text-green-400"></i>
                            <span>Cryptage Argon2id</span>
                        </div>
                        <div class="flex items-center gap-3 text-xs">
                            <i class="fas fa-check-circle text-green-400"></i>
                            <span>Verrouillage automatique</span>
                        </div>
                        <div class="flex items-center gap-3 text-xs">
                            <i class="fas fa-check-circle text-green-400"></i>
                            <span>Protection Multi-sessions</span>
                        </div>
                    </div>
                </div>

                <!-- Right Form Section -->
                <div class="p-6 md:p-10 md:w-2/3">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-slate-800">Modifier mon Code PIN</h1>
                        <p class="text-slate-500 text-sm mt-1">Vous pouvez changer votre code à tout moment pour plus de
                            sécurité.</p>
                    </div>

                    {% for message in app.flashes('success') %}
                    <div
                        class="mb-6 p-4 bg-green-50 border border-green-100 rounded-2xl text-green-700 text-sm flex items-center gap-3">
                        <i class="fas fa-check-circle"></i>
                        <span>{{ message }}</span>
                    </div>
                    {% endfor %}

                    {% for message in app.flashes('error') %}
                    <div
                        class="mb-6 p-4 bg-red-50 border border-red-100 rounded-2xl text-red-700 text-sm flex items-center gap-3">
                        <i class="fas fa-circle-exclamation"></i>
                        <span>{{ message }}</span>
                    </div>
                    {% endfor %}

                    <form method="post" action="{{ path('pin_change') }}" class="space-y-6">
                        <div>
                            <label class="block text-xs font-bold text-gray-600 uppercase tracking-widest mb-3">Code
                                PIN Actuel</label>
                            <input type="password" name="old_pin" required
                                class="block w-full px-6 py-4 bg-gray-50 border-2 border-transparent focus:bg-white focus:border-green-600 rounded-2xl text-slate-900 transition-all text-center text-xl tracking-[0.2em] md:tracking-[0.5em] font-bold"
                                placeholder="•••••" maxlength="5" pattern="\d{5}" inputmode="numeric">
                        </div>

                        <div class="grid md:grid-cols-2 gap-6 pt-4 border-t border-gray-100">
                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-600 uppercase tracking-widest mb-3">Nouveau
                                    PIN</label>
                                <input type="password" name="new_pin" required
                                    class="block w-full px-6 py-4 bg-gray-50 border-2 border-transparent focus:bg-white focus:border-green-600 rounded-2xl text-slate-900 transition-all text-center text-xl tracking-[0.2em] md:tracking-[0.5em] font-bold"
                                    placeholder="•••••" maxlength="5" pattern="\d{5}" inputmode="numeric">
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-600 uppercase tracking-widest mb-3">Confirmation</label>
                                <input type="password" name="new_pin_confirm" required
                                    class="block w-full px-6 py-4 bg-gray-50 border-2 border-transparent focus:bg-white focus:border-green-600 rounded-2xl text-slate-900 transition-all text-center text-xl tracking-[0.2em] md:tracking-[0.5em] font-bold"
                                    placeholder="•••••" maxlength="5" pattern="\d{5}" inputmode="numeric">
                            </div>
                        </div>

                        <div class="pt-6 flex flex-col sm:flex-row gap-4">
                            <button type="submit"
                                class="flex-1 bg-green-700 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-2xl transition-all shadow-lg shadow-green-900/10 flex items-center justify-center gap-3">
                                <i class="fas fa-save text-sm opacity-50"></i>
                                Enregistrer les modifications
                            </button>
                            <a href="{{ path('app_dashboard') }}"
                                class="py-4 px-8 text-slate-500 hover:text-slate-800 font-semibold text-center transition-colors">
                                Annuler
                            </a>
                        </div>
                    </form>

                    <div
                        class=" border-t border-gray-50 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div class="flex items-center gap-2 text-gray-600 text-xs">
                            <i class="fas fa-info-circle"></i>
                            Besoin d'aide ?
                        </div>
                        <a href="{{ path('pin_reset_request') }}"
                            class="text-green-600 hover:text-green-700 text-sm font-bold flex items-center gap-2 group">
                            Code PIN oublié ?
                            <i
                                class="fas fa-arrow-right text-[10px] transform group-hover:translate-x-1 transition-transform"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('input[type="password"]').forEach(input => {
        input.addEventListener('input', function (e) {
            this.value = this.value.replace(/[^\d]/g, '');
        });
    });
</script>
{% endblock %}