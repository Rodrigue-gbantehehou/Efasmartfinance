{% extends "dashboard/base.html.twig" %}
{% block contentdashboard %}
	<!-- Mobile Header -->


	<!-- Desktop Header -->
		<header class="hidden md:block bg-white border-b border-gray-100 sticky top-0 z-30 flex-shrink-0"> <div
			class="max-w-[1400px] mx-auto px-4 md:px-6 py-3 flex items-center gap-3">
			<!-- Quick Actions -->
			<div class="flex items-center gap-2 flex-1">
				<a href="{{path('app_tontine')}}" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-lg bg-green-700 text-white hover:bg-green-700 transition-colors font-medium touch-target">
					<i class="fa-solid fa-plus"></i>
					Nouvelle tontine
				</a>

				{% if app.user.verificationStatut == "pending" %}
    <div class="relative group">
        <button disabled class="inline-flex items-center gap-2 px-4 py-2.5 rounded-lg bg-yellow-100 text-yellow-800 cursor-not-allowed font-medium touch-target border border-yellow-200 shadow-sm">
            <i class="fa-regular fa-clock animate-pulse"></i>
            Vérification en cours...
        </button>
        <div class="absolute z-10 hidden group-hover:block w-64 p-3 mt-2 text-sm text-gray-600 bg-white border border-gray-200 rounded-lg shadow-lg">
            Votre demande de vérification est en cours de traitement par notre équipe. Cela peut prendre jusqu'à 24 heures.
        </div>
    </div>
{% elseif app.user.verificationStatut == "verified" %}
    
{% else %}
    <a href="{{path('app_compte_verification')}}" class="relative group inline-flex items-center gap-2 px-4 py-2.5 rounded-lg bg-gradient-to-r from-green-600 to-green-700 text-white font-medium touch-target hover:from-green-700 hover:to-green-800 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
        <i class="fa-solid fa-user-shield"></i>
        Vérifier mon compte
        <span class="absolute -top-2 -right-2 flex h-5 w-5 items-center justify-center rounded-full bg-yellow-400 text-xs font-bold text-white">!</span>
    </a>
{% endif %}
			</div>

			<div
				class="flex items-center gap-3 ml-auto">
				<!-- Notifications -->
				<div class="relative">
					<button class="relative h-10 w-10 rounded-lg hover:bg-gray-100 flex items-center justify-center touch-target">
						<i class="fa-regular fa-bell text-gray-700"></i>
						<span id="notificationCount" class="absolute -top-1 -right-1 h-5 w-5 rounded-full bg-warning text-white text-xs flex items-center justify-center">3</span>
					</button>
				</div>

				<!-- User Menu -->
				<div class="flex items-center gap-3">
					<div class="text-right hidden md:block">
						<div class="font-semibold leading-4" id="userDisplayName">John Doe</div>
						{% if app.user.verificationStatut == "verified" %}
							<div class="text-xs text-green-600">Compte vérifié</div>
						{% else %}
							<div class="text-xs text-red-500">Compte non vérifié</div>
						{% endif %}
					</div>
					<div class="relative">
						<button id="userMenuButton" class="h-10 w-10 rounded-full bg-green-700/10 text-green-700 flex items-center justify-center hover:bg-green-700/20 touch-target">
							<i class="fa-solid fa-user"></i>
						</button>
						<div id="userMenu" class="absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-50">
							<a href="{{path('app_settings')}}" class="block px-4 py-3 hover:bg-gray-50">
								<i class="fa-solid fa-user mr-3"></i>
								Mon profil</a>
							{% if app.user.verificationStatut == "verified" %}

								<a href="{{path('app_resend_verification')}}" class="block px-4 py-3 hover:bg-gray-50">
									<i class="fa-solid fa-envelope mr-3"></i>
									Vérifier compte</a>
							{% endif %}

							<div class="border-t border-gray-200"></div>
							<a href="{{ path('app_logout') }}" class="block px-4 py-3 text-red-600 hover:bg-gray-50">
								<i class="fa-solid fa-right-from-bracket mr-3"></i>
								Déconnexion</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</header>

	<!-- Content Area -->
	<div class="max-w-[1400px] mx-auto px-3 xs:px-4 md:px-6 py-3 md:py-6 space-y-3 md:space-y-6 safe-bottom">

		<!-- Welcome Banner -->
		<!-- Welcome Banner - Version avec colonnes sur même ligne -->
			<div
			class="bg-gradient-to-r from-green-700 to-green-600 text-white rounded-xl md:rounded-2xl p-4 md:p-6 card-hover"> <!-- Grille responsive : toujours sur la même ligne -->
			<div
				class="grid grid-cols-2 md:grid-cols-2 gap-4 md:gap-8 items-center">

				<!-- Colonne gauche - Texte et badges -->
				<div class="flex flex-col h-full justify-center">
					<h1 class="text-xl xs:text-2xl md:text-3xl font-bold mb-2 md:mb-3 leading-tight">
						Bonjour,
					</br>
					<span id="welcomeUserName" class="truncate inline-block max-w-[140px] xs:max-w-[160px] sm:max-w-[200px] md:max-w-full">
						{{user.firstName}}
					</span>
					!
				</h1>

				<p class="opacity-90 text-sm xs:text-base md:text-lg leading-relaxed mb-3 md:mb-4">
					Gérez vos tontines et suivez votre épargne en temps réel.
				</p>

				<!-- Badges en ligne compacte -->
				<div class="flex flex-wrap gap-1.5 md:gap-2">
					<div class="bg-white/20 px-2.5 py-1 md:px-3 md:py-1.5 rounded-full text-xs md:text-sm flex items-center whitespace-nowrap">
						<i class="fa-solid fa-shield-alt mr-1.5 text-xs md:text-sm"></i>
						<span>Sécurisé</span>
					</div>
					<div class="bg-white/20 px-2.5 py-1 md:px-3 md:py-1.5 rounded-full text-xs md:text-sm flex items-center whitespace-nowrap">
						<i class="fa-solid fa-bolt mr-1.5 text-xs md:text-sm"></i>
						<span>Automatisé</span>
					</div>

				</div>
			</div>

			<!-- Colonne droite - Solde et bouton -->
			<div class="flex flex-col items-center md:items-end justify-center h-full">
				<div class="text-right md:text-right">
					<div class="flex items-center gap-2">
						<button type="button" id="toggleBalance" class="text-white hover:text-white focus:outline-none" aria-label="Afficher/masquer le solde">
							<i class="fa-solid fa-eye-slash" id="balanceIcon"></i>
						</button>
						<div class="text-2xl xs:text-3xl sm:text-4xl md:text-5xl font-bold mb-1 md:mb-2 leading-none" id="totalBalance">
							0 FCFA
						</div>
					</div>

					<div class="text-xs md:text-sm opacity-90 mb-2 md:mb-3">
						Montant total épargné
					</div>

				</div>
			</div>
		</div>
	</div>
<!-- Mes tontines -->
	<section class="bg-white rounded-lg md:rounded-xl p-3 md:p-5 border border-gray-100 card-hover mt-4">
		<div class="flex flex-col xs:flex-row xs:items-center justify-between mb-3 md:mb-4 gap-2">
			<h3 class="font-semibold text-gray-800 text-base md:text-lg">Mes tontines</h3>
			<div class="flex items-center gap-3">
				<a href="#" class="text-sm text-green-700 hover:text-accent flex items-center gap-1 touch-target whitespace-nowrap">
					<i class="fa-solid fa-list"></i>
					<span class="hidden xs:inline">Toutes</span>
				</a>
				<div class="h-4 w-px bg-gray-200"></div>
				<a href="#" class="text-sm text-green-700 hover:text-accent flex items-center gap-1 touch-target whitespace-nowrap">
					<i class="fa-solid fa-filter"></i>
					<span class="hidden xs:inline">Filtrer</span>
				</a>
			</div>
		</div>

		<!-- Tableau des tontines - Version mobile friendly -->
		<div class="overflow-x-auto">
			<div class="min-w-full inline-block align-middle">
				<!-- Desktop Table -->
				<table class="min-w-full text-sm md:table">
					<thead>
						<tr class="text-left text-gray-500 border-b">
							<th class="py-3 pr-2 text-center">N°</th>
							<th class="py-3 pr-2 "> Tontine</th>
							<th class="py-3 pr-2 hidden md:table">Périodicité</th>
							<th class="py-3 pr-2">Reste à Payer</th>
							<th class="py-3 pr-2 hidden md:table">Échéance</th>
							<th class="py-3 pr-2">Progression</th>
							<th class="py-3 pr-2">Statut</th>
							<th class="py-3">Actions</th>
						</tr>
					</thead>
					<tbody id="tontinesTableBody" class="divide-y">
						<tr>
							<td colspan="8" class="py-8 text-center text-gray-500">
								<i class="fa-solid fa-piggy-bank text-3xl text-gray-300 mb-3 block"></i>
								<p class="mb-3">Aucune tontine créée pour le moment</p>
								<a href="{{path('app_tontine')}}" class="inline-block px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-700 text-sm transition-colors touch-target">
									Créer ma première tontine
								</a>
							</td>
						</tr>
					</tbody>
				</table>

				
			</div>
		</div>
	</section>

	<!-- Échéances à venir - Version mobile -->
	<section class="bg-white rounded-lg md:rounded-xl p-3 md:p-5 border border-gray-100 card-hover">
		<div class="flex flex-col xs:flex-row xs:items-center justify-between mb-3 md:mb-4 gap-2">
			<h3 class="font-semibold text-gray-800 text-sm md:text-lg">Échéances à venir</h3>
		<!-- 	<a href="#" class="text-xs md:text-sm text-green-700 hover:text-accent flex items-center gap-1 touch-target whitespace-nowrap">
				<i class="fa-solid fa-calendar-alt"></i>
				<span class="hidden xs:inline">Voir calendrier</span>
			</a> -->
		</div>

		<div
			class="grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-4 gap-2 md:gap-3" id="upcomingPayments">
			<!-- Les échéances seront ajoutées dynamiquement ici -->
			<div class="col-span-full bg-gray-50 rounded-lg p-4 md:p-6 border border-gray-200 text-center">
				<i class="fa-solid fa-calendar-check text-xl md:text-3xl text-gray-300 mb-2 md:mb-3 block"></i>
				<p class="text-gray-500 text-sm md:text-base">Aucune échéance à venir</p>
				<p class="text-xs text-gray-400 mt-1">Tout est à jour</p>
			</div>
		</div>
	</section>
	
	<!-- Charts & Quick Actions -->
	<section class="">
    <div class="bg-white rounded-lg md:rounded-xl p-3 md:p-5 border border-gray-100 card-hover">
        <h3 class="font-semibold text-gray-800 mb-3 md:mb-4 text-sm md:text-lg">Actions rapides</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-1.5 md:gap-2">
            <!-- Bouton 1 -->
            <a href="{{path('app_tontine')}}" 
               class="flex flex-col items-center justify-center p-3 md:p-4 rounded-lg border border-gray-200 hover:bg-green-700/5 hover:border-green-700 transition-colors touch-target text-center">
                <div class="h-10 w-10 md:h-12 md:w-12 rounded-lg bg-green-700/10 text-green-700 flex items-center justify-center mb-2">
                    <i class="fa-solid fa-plus text-base md:text-lg"></i>
                </div>
                <div class="min-w-0 w-full">
                    <div class="font-medium text-xs md:text-sm truncate">Créer une tontine</div>
                    <div class="text-xs text-gray-500 truncate hidden sm:block">Lancer une nouvelle épargne</div>
                </div>
            </a>

            <!-- Bouton 2 
            <a href="#" 
               class="flex flex-col items-center justify-center p-3 md:p-4 rounded-lg border border-gray-200 hover:bg-green-700/5 hover:border-green-700 transition-colors touch-target text-center">
                <div class="h-10 w-10 md:h-12 md:w-12 rounded-lg bg-secondary/10 text-green-700 flex items-center justify-center mb-2">
                    <i class="fa-solid fa-money-bill-transfer text-base md:text-lg"></i>
                </div>
                <div class="min-w-0 w-full">
                    <div class="font-medium text-xs md:text-sm truncate">Effectuer un paiement</div>
                    <div class="text-xs text-gray-500 truncate hidden sm:block">Cotiser à une tontine</div>
                </div>
            </a>-->

            <!-- Bouton 3 
            <a href="#" 
               class="flex flex-col items-center justify-center p-3 md:p-4 rounded-lg border border-gray-200 hover:bg-green-700/5 hover:border-green-700 transition-colors touch-target text-center">
                <div class="h-10 w-10 md:h-12 md:w-12 rounded-lg bg-accent/10 text-accent flex items-center justify-center mb-2">
                    <i class="fa-solid fa-chart-pie text-base md:text-lg"></i>
                </div>
                <div class="min-w-0 w-full">
                    <div class="font-medium text-xs md:text-sm truncate">Statistiques</div>
                    <div class="text-xs text-gray-500 truncate hidden sm:block">Analyser vos performances</div>
                </div>
            </a>-->

            <!-- Bouton 4 
            <a href="#" 
               class="flex flex-col items-center justify-center p-3 md:p-4 rounded-lg border border-gray-200 hover:bg-green-700/5 hover:border-green-700 transition-colors touch-target text-center">
                <div class="h-10 w-10 md:h-12 md:w-12 rounded-lg bg-warning/10 text-warning flex items-center justify-center mb-2">
                    <i class="fa-solid fa-bell text-base md:text-lg"></i>
                </div>
                <div class="min-w-0 w-full">
                    <div class="font-medium text-xs md:text-sm truncate">Rappels</div>
                    <div class="text-xs text-gray-500 truncate hidden sm:block">Configurer notifications</div>
                </div>
            </a>-->
        </div>
    </div>
</section>

	

	<!-- Footer -->
	<div class="text-center text-xs text-gray-400 py-3 md:py-4">
		<p class="mb-1 truncate">EFA SMART FINANCE • Sécurisé avec cryptage bancaire</p>
		<p class="text-xxs md:text-xs">Support: support@efasmartfinance.com</p>
		<p class="mt-1 md:mt-2 text-xxs md:text-xs">©
			<span id="currentYear">{{ "now"|date("Y") }}</span>
			Tous droits réservés</p>
	</div>
</div>

<!-- Mobile Bottom Actions -->
<div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 safe-bottom">
	<div class="flex items-center justify-around p-2">
		<a href="{{path('app_tontine')}}" class="flex flex-col items-center p-2 text-green-700 touch-target">
			<i class="fa-solid fa-plus text-lg mb-1"></i>
			<span class="text-xs">Nouvelle</span>
		</a>
		<a href="#" class="flex flex-col items-center p-2 text-gray-600 hover:text-green-700 touch-target">
			<i class="fa-solid fa-chart-pie text-lg mb-1"></i>
			<span class="text-xs">Stats</span>
		</a>
		<a href="#" class="flex flex-col items-center p-2 text-gray-600 hover:text-green-700 touch-target">
			<i class="fa-solid fa-bell text-lg mb-1"></i>
			<span class="text-xs">Alertes</span>
		</a>
		<a href="#" class="flex flex-col items-center p-2 text-gray-600 hover:text-green-700 touch-target">
			<i class="fa-solid fa-user text-lg mb-1"></i>
			<span class="text-xs">Profil</span>
		</a>
	</div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
	<div class="bg-white rounded-xl p-4 md:p-6 flex flex-col items-center">
		<div class="spinner h-10 w-10 md:h-12 md:w-12 mb-3 md:mb-4"></div>
		<p class="text-gray-700 text-sm md:text-base">Chargement...</p>
	</div>
</div>

<!-- Le JavaScript est maintenant dans le fichier dashboard.js -->
<script>
	// Fonction pour basculer l'affichage du solde
	document.addEventListener('DOMContentLoaded', function() {
		const toggleButton = document.getElementById('toggleBalance');
		const balanceElement = document.getElementById('totalBalance');
		const balanceIcon = document.getElementById('balanceIcon');
		let isBalanceVisible = true;

		toggleButton.addEventListener('click', function() {
			isBalanceVisible = !isBalanceVisible;
			
			if (isBalanceVisible) {
				balanceElement.textContent = balanceElement.getAttribute('data-amount') + ' FCFA';
				balanceIcon.classList.remove('fa-eye');
				balanceIcon.classList.add('fa-eye-slash');
			} else {
				// Sauvegarder le montant dans un attribut data pour le réafficher plus tard
				const currentAmount = balanceElement.textContent.replace(' FCFA', '').trim();
				balanceElement.setAttribute('data-amount', currentAmount);
				balanceElement.textContent = '••••••••';
				balanceIcon.classList.remove('fa-eye-slash');
				balanceIcon.classList.add('fa-eye');
			}
		});

		// Initialisation du montant dans l'attribut data
		const initialAmount = balanceElement.textContent.replace(' FCFA', '').trim();
		balanceElement.setAttribute('data-amount', initialAmount);
	});

	// Script existant... dans le fichier dashboard.js 
</script>{% endblock %}
