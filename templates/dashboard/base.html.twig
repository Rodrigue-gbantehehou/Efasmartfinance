<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="theme-color" content="#10B981">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>EFA SMART FINANCE — Tableau de bord Tontines</title>
  <meta name="description" content="Tableau de bord des tontines individuelles pour la gestion de vos épargnes." />
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  
  <!-- Charts -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css">
  
  <!-- Payment SDKs -->
  <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>
  <script src="https://cdn.kkiapay.me/k.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_public_key }}"></script>
  
  <!-- Your JS -->
  <script src="assets/js/main.js"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#10B981',
            secondary: '#FBBF24',
            accent: '#059669',
            warning: '#F59E0B',
            danger: '#EF4444',
            light: '#f8f9fa',
          },
          screens: {
            'xs': '375px',
            'sm': '640px',
            'md': '768px',
            'lg': '1024px',
            'xl': '1280px',
            '2xl': '1536px',
          },
          fontSize: {
            'xxs': '0.625rem', // 10px
            'xs': '0.75rem',   // 12px
            'sm': '0.875rem',  // 14px
            'base': '1rem',    // 16px
            'lg': '1.125rem',  // 18px
            'xl': '1.25rem',   // 20px
            '2xl': '1.5rem',   // 24px
            '3xl': '1.875rem', // 30px
            '4xl': '2.25rem',  // 36px
          },
          spacing: {
            '18': '4.5rem',
            '88': '22rem',
            '128': '32rem',
          }
        }
      }
    }
  </script>
  
  <style>
    /* Reset and base styles */
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Safe area insets for modern phones */
    .safe-top {
      padding-top: env(safe-area-inset-top);
    }
    
    .safe-bottom {
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    /* Prevent zoom on input focus iOS */
    input, select, textarea {
      font-size: 16px !important;
    }
    
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    /* Hide scrollbar but keep functionality */
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    /* Better touch targets */
    .touch-target {
      min-height: 44px;
      min-width: 44px;
    }
    
    /* Modal animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { 
        transform: translateY(20px); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0); 
        opacity: 1; 
      }
    }
    
    @keyframes slideInRight {
      from { 
        transform: translateX(100%); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0); 
        opacity: 1; 
      }
    }
    
    .modal-enter {
      animation: fadeIn 0.2s ease-out;
    }
    
    .modal-content-enter {
      animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .drawer-enter {
      animation: slideInRight 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    /* Payment methods */
    .payment-option {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      touch-action: manipulation;
    }
    
    .payment-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .payment-option:active {
      transform: translateY(0);
    }
    
    .payment-option.selected {
      border-color: #10b981;
      background-color: rgba(16, 185, 129, 0.05);
    }
    
    .payment-option.selected .check-icon {
      opacity: 1;
      transform: scale(1);
    }
    
    .check-icon {
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Loading states */
    .spinner {
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: #10b981;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    /* Progress animations */
    .progress-fill {
      transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    /* Card hover effects */
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Mobile optimizations */
    @media (max-width: 640px) {
      /* Improve readability on small screens */
      h1 { font-size: 1.5rem !important; }
      h2 { font-size: 1.25rem !important; }
      h3 { font-size: 1.125rem !important; }
      
      /* Better spacing on mobile */
      .mobile-padding {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      
      /* Full width buttons on mobile */
      .mobile-full-width {
        width: 100% !important;
      }
      
      /* Hide non-essential elements on mobile */
      .mobile-hide {
        display: none !important;
      }
      
      /* Show mobile-only elements */
      .mobile-only {
        display: block !important;
      }
    }
    
    @media (min-width: 641px) {
      .mobile-only {
        display: none !important;
      }
      
      .desktop-only {
        display: block !important;
      }
    }
    
    /* Fix for iOS input zoom */
    @supports (-webkit-touch-callout: none) {
      input, textarea {
        font-size: 16px !important;
      }
    }
    
    /* Overscroll behavior */
    body {
      overscroll-behavior-y: contain;
    }
    
    /* Selection color */
    ::selection {
      background-color: rgba(16, 185, 129, 0.3);
    }
  </style>
  
  {% include 'dashboard/links/_css.html.twig' %}
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col safe-top safe-bottom">
  <!-- App Shell -->
  <div class="flex-1 flex flex-col md:flex-row h-screen overflow-hidden">
    
    <!-- Mobile Header -->
    {% include "dashboard/partiales/mobileheader.html.twig" %}

    <!-- Desktop Sidebar -->
    {% include "dashboard/partiales/sidebardesktop.html.twig" %}

    <!-- Main Content -->
    <main id="main-content" class="flex-1 min-w-0 flex flex-col overflow-y-auto scrollbar-hide" role="main">
      <!-- Desktop Topbar -->
      <div class="flex-1">
        {% block contentdashboard %}
        <!-- Content will be injected here -->
        {% endblock %}
      </div>
    </main>
  </div>

  <!-- Mobile Drawer -->
  {% include "dashboard/partiales/mobiledrawer.html.twig" %}
  
  <!-- Bottom Navigation Mobile -->
  {% include "dashboard/partiales/bottom_nav_mobile.html.twig" %}

  <!-- Notifications Container -->
  <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2 w-full max-w-sm px-4 sm:px-0 sm:w-auto"></div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl p-6 flex flex-col items-center">
      <div class="spinner h-12 w-12 mb-4"></div>
      <p class="text-gray-700">Chargement...</p>
    </div>
  </div>

  <!-- Modal Container -->
  <div id="modal-container" class="fixed inset-0 z-40 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
      <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
      <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
      <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
        <!-- Modal content will be injected here -->
      </div>
    </div>
  </div>

  
  <!-- Mobile Optimizations Script -->
  <script>
    // Mobile optimizations
    document.addEventListener('DOMContentLoaded', function() {
      // Prevent pinch zoom on iOS
      document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
      });
      
      // Fix viewport height on mobile
      function setVH() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      }
      
      setVH();
      window.addEventListener('resize', setVH);
      window.addEventListener('orientationchange', setVH);
      
      // Add touch feedback to buttons
      document.querySelectorAll('button, a').forEach(el => {
        el.classList.add('touch-target');
        
        // Add ripple effect on touch
        el.addEventListener('touchstart', function(e) {
          this.classList.add('scale-95');
        });
        
        el.addEventListener('touchend', function() {
          this.classList.remove('scale-95');
        });
      });
      
      // Better scroll for iOS
      if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
      }
      
      // Handle keyboard appearance on iOS
      let viewport = document.querySelector("meta[name=viewport]");
      window.addEventListener('focusin', function() {
        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0');
      });
      
      window.addEventListener('focusout', function() {
        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes');
      });
    });
    
    // Show loading overlay
    function showLoading(message = 'Chargement...') {
      const overlay = document.getElementById('loading-overlay');
      if (overlay) {
        overlay.querySelector('p').textContent = message;
        overlay.classList.remove('hidden');
      }
    }
    
    // Hide loading overlay
    function hideLoading() {
      const overlay = document.getElementById('loading-overlay');
      if (overlay) {
        overlay.classList.add('hidden');
      }
    }
    
    // Show notification
    function showNotification(message, type = 'info', duration = 5000) {
      const container = document.getElementById('notifications');
      if (!container) return;
      
      const notification = document.createElement('div');
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      };
      
      notification.className = `${colors[type] || colors.info} text-white px-4 py-3 rounded-lg shadow-lg flex items-center justify-between transform translate-x-full transition-transform duration-300`;
      notification.innerHTML = `
        <div class="flex items-center">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} mr-2"></i>
          <span class="text-sm">${message}</span>
        </div>
        <button onclick="this.parentElement.remove()" class="ml-4 text-white/80 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      container.appendChild(notification);
      
      // Slide in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 10);
      
      // Auto remove
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
      }, duration);
    }
    
    // Detect mobile device
    function isMobile() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }
    
    // Detect iOS
    function isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    }
    
    // Handle back button on mobile
    if (isMobile()) {
      let backButtonPressed = false;
      
      window.addEventListener('popstate', function() {
        if (!backButtonPressed) {
          backButtonPressed = true;
          showNotification('Appuyez à nouveau pour quitter', 'info', 2000);
          
          setTimeout(() => {
            backButtonPressed = false;
          }, 2000);
        } else {
          // Actually exit
          if (isIOS()) {
            window.location.href = 'about:blank';
          }
        }
      });
    }
  </script>
</body>

{% include 'dashboard/links/_js.html.twig' %}
</html>