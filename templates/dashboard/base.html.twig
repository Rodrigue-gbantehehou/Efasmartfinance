<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="theme-color" content="#008040">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>EFA SMART FINANCE — Tableau de bord Tontines</title>
  <meta name="description" content="Tableau de bord des tontines individuelles pour la gestion de vos épargnes." />
  <link rel="icon" href="{{ asset('images/logovert.png') }}" type="image/png">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  
  <!-- Charts -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css">
  
  <!-- Payment SDKs -->
  <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>
  <script src="https://cdn.kkiapay.me/k.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_public_key }}"></script>
  
  <!-- Your JS -->
  <script src="{{ asset('assets/js/main.js') }}"></script>
  <script src="{{ asset('assets/js/dashboard.js') }}" defer></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'green-700': '#008040',
            secondary: '#FBBF24',
            accent: '#059669',
            warning: '#F59E0B',
            danger: '#EF4444',
            light: '#f8f9fa',
          },
          screens: {
            'xs': '375px',
            'sm': '640px',
            'md': '768px',
            'lg': '1024px',
            'xl': '1280px',
            '2xl': '1536px',
          },
          fontSize: {
            'xxs': '0.625rem', // 10px
            'xs': '0.75rem',   // 12px
            'sm': '0.875rem',  // 14px
            'base': '1rem',    // 16px
            'lg': '1.125rem',  // 18px
            'xl': '1.25rem',   // 20px
            '2xl': '1.5rem',   // 24px
            '3xl': '1.875rem', // 30px
            '4xl': '2.25rem',  // 36px
          },
          spacing: {
            '18': '4.5rem',
            '88': '22rem',
            '128': '32rem',
          }
        }
      }
    }
  </script>
  
  <style>
    /* Reset and base styles */
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Safe area insets for modern phones */
    .safe-top {
      padding-top: env(safe-area-inset-top);
    }
    
    .safe-bottom {
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    /* Prevent zoom on input focus iOS */
    input, select, textarea {
      font-size: 16px !important;
    }
    
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    /* Hide scrollbar but keep functionality */
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    /* Better touch targets */
    .touch-target {
      min-height: 44px;
      min-width: 44px;
    }
    
    /* Modal animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { 
        transform: translateY(20px); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0); 
        opacity: 1; 
      }
    }
    
    @keyframes slideInRight {
      from { 
        transform: translateX(100%); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0); 
        opacity: 1; 
      }
    }
    
    .modal-enter {
      animation: fadeIn 0.2s ease-out;
    }
    
    .modal-content-enter {
      animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .drawer-enter {
      animation: slideInRight 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    /* Payment methods */
    .payment-option {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      touch-action: manipulation;
    }
    
    .payment-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .payment-option:active {
      transform: translateY(0);
    }
    
    .payment-option.selected {
      border-color: #008040;
      background-color: rgba(16, 185, 129, 0.05);
    }
    
    .payment-option.selected .check-icon {
      opacity: 1;
      transform: scale(1);
    }
    
    .check-icon {
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Loading states */
    .spinner {
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: #008040;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    /* Progress animations */
    .progress-fill {
      transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    /* Card hover effects */
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Mobile optimizations */
    @media (max-width: 640px) {
      /* Improve readability on small screens */
      h1 { font-size: 1.5rem !important; }
      h2 { font-size: 1.25rem !important; }
      h3 { font-size: 1.125rem !important; }
      
      /* Better spacing on mobile */
      .mobile-padding {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      
      /* Full width buttons on mobile */
      .mobile-full-width {
        width: 100% !important;
      }
      
      /* Hide non-essential elements on mobile */
      .mobile-hide {
        display: none !important;
      }
      
      /* Show mobile-only elements */
      .mobile-only {
        display: block !important;
      }
    }
    
    @media (min-width: 641px) {
      .mobile-only {
        display: none !important;
      }
      
      .desktop-only {
        display: block !important;
      }
    }
    
    /* Fix for iOS input zoom */
    @supports (-webkit-touch-callout: none) {
      input, textarea {
        font-size: 16px !important;
      }
    }
    
    /* Overscroll behavior */
    body {
      overscroll-behavior-y: contain;
    }
    
    /* Centralized background color management */
    :root {
      --app-bg-primary: #F0F9F1; /* bg-green-50 equivalent - MODIFIER ICI POUR CHANGER LE FOND */
      --app-bg-secondary: #FFFFFF;
      --app-bg-tertiary: #DDEFE0; /* bg-green-100 equivalent */
    }
    
    /* Selection color */
    ::selection {
      background-color: rgba(16, 185, 129, 0.3);
    }
  </style>
  <style>
  /* Styles de base pour les alertes */
  .alert {
    border: 1px solid;
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    position: relative;
    backdrop-filter: blur(8px);
  }
  
  .alert-success {
    background: white;
    border-color: rgba(16, 185, 129, 0.2);
    color: #065f46;
  }
  
  .alert-error {
    background: white;
    border-color: rgba(244, 63, 94, 0.2);
    color: #881337;
  }
  
  .alert-warning {
    background:white;
    border-color: rgba(245, 158, 11, 0.2);
    color: #854d0e;
  }
  
  .alert-info {
    background: white;
    border-color: rgba(59, 130, 246, 0.2);
    color: #1e40af;
  }
  
  .alert-other {
    background: white;
    border-color: rgba(107, 114, 128, 0.2);
    color: #374151;
  }
  
  /* Animation d'entrée */
  @keyframes popIn {
    from {
      opacity: 0;
      transform: scale(0.95) translateY(10px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }
  
  /* Animation de sortie */
  @keyframes fadeOut {
    to {
      opacity: 0;
      transform: scale(0.95) translateY(-10px);
    }
  }
  
  .flash-message.exiting {
    animation: fadeOut 0.25s ease-in forwards;
  }
  
  /* Overlay semi-transparent */
  #flash-messages::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: auto;
  }
  
  #flash-messages:has(.flash-message:not(.exiting))::before {
    opacity: 1;
  }
</style>
  {% include 'dashboard/links/_css.html.twig' %}
</head>

<body class="text-gray-800 min-h-screen flex flex-col safe-top safe-bottom" style="background-color: var(--app-bg-primary);">
<!-- Flash Messages - Version Centrée -->
<div id="flash-messages" class="fixed inset-0 z-[9999] flex items-center justify-center pointer-events-none p-4">
  {% for label, messages in app.flashes %}
    {% for message in messages %}
      <div 
        class="flash-message alert alert-{{ label }} mb-4 p-6 rounded-xl shadow-2xl backdrop-blur-md transition-all duration-300 ease-out transform opacity-0 scale-95 pointer-events-auto max-w-md w-full mx-auto"
        data-label="{{ label }}"
        data-autoclose="{{ label in ['success', 'info'] ? 'true' : 'false' }}"
      >
        <div class="flex flex-col items-center text-center">
          <!-- Icône principale -->
          <div class="mb-4 p-3 rounded-full bg-white/50">
            {% if label == 'success' %}
              <i class="fas fa-check-circle text-emerald-500 text-3xl"></i>
            {% elseif label == 'error' %}
              <i class="fas fa-times-circle text-rose-500 text-3xl"></i>
            {% elseif label == 'warning' %}
              <i class="fas fa-exclamation-triangle text-amber-500 text-3xl"></i>
            {% elseif label == 'info' %}
              <i class="fas fa-info-circle text-green-500 text-3xl"></i>
            {% else %}
              <i class="fas fa-bell text-gray-500 text-3xl"></i>
            {% endif %}
          </div>
          
          <!-- Titre -->
          <h3 class="text-xl font-bold mb-2 text-gray-900">
            {% if label == 'success' %}
              Succès !
            {% elseif label == 'error' %}
              Oups !
            {% elseif label == 'warning' %}
              Attention
            {% elseif label == 'info' %}
              Information
            {% else %}
              Notification
            {% endif %}
          </h3>
          
          <!-- Message -->
          <div class="text-gray-700 mb-6">
            {{ message|raw }}
          </div>
          
          <!-- Bouton de fermeture -->
          <button 
            type="button" 
            class="flash-close-btn px-6 py-2 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"
            aria-label="Fermer"
          >
            {% if label == 'success' %}
              <span class="text-emerald-700 hover:text-emerald-800 focus:ring-emerald-300">Continuer</span>
            {% elseif label == 'error' %}
              <span class="text-rose-700 hover:text-rose-800 focus:ring-rose-300">Compris</span>
            {% elseif label == 'warning' %}
              <span class="text-amber-700 hover:text-amber-800 focus:ring-amber-300">J'ai compris</span>
            {% else %}
              <span class="text-green-700 hover:text-green-800 focus:ring-green-300">OK</span>
            {% endif %}
          </button>
        </div>
        
        <!-- Bouton de fermeture en X (optionnel) -->
        <button 
          type="button" 
          class="absolute top-3 right-3 flash-close-btn text-gray-400 hover:text-gray-600 transition-colors p-1"
          aria-label="Fermer"
        >
          <i class="fas fa-times text-lg"></i>
        </button>
        
        <!-- Barre de progression -->
        {% if label in ['success', 'info'] %}
          <div class="flash-progress absolute bottom-0 left-4 right-4 h-1 rounded-full overflow-hidden bg-gray-200/50">
            <div class="flash-progress-bar h-full rounded-full bg-current opacity-40 w-0"></div>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  {% endfor %}
</div>




  
  <!-- App Shell -->
  <div class="flex-1 flex flex-col md:flex-row h-screen overflow-hidden">
    
    <!-- Mobile Header -->
    {% include "dashboard/partiales/mobileheader.html.twig" %}

    <!-- Desktop Sidebar -->
    {% include "dashboard/partiales/sidebardesktop.html.twig" %}

    <!-- Main Content -->
    <main id="main-content" class="flex-1 min-w-0 flex flex-col overflow-y-auto scrollbar-hide pb-24 md:pb-0" role="main">
      <!-- Desktop Topbar -->
      <div class="flex-1">
        {% block contentdashboard %}
        <!-- Content will be injected here -->
        {% endblock %}
      </div>
    </main>
  </div>

  <!-- Mobile Drawer -->
  {% include "dashboard/partiales/mobiledrawer.html.twig" %}
  
  <!-- Bottom Navigation Mobile -->
  {% include "dashboard/partiales/bottom_nav_mobile.html.twig" %}
  
  {% for label, messages in app.flashes %}
      {% for message in messages %}
          <div class="alert alert-{{ label }}" role="alert">
              {{ message }}
          </div>
      {% endfor %}
  {% endfor %}
  <!-- Notifications Container -->
  <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2 w-full max-w-sm px-4 sm:px-0 sm:w-auto"></div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl p-6 flex flex-col items-center">
      <div class="spinner h-12 w-12 mb-4"></div>
      <p class="text-gray-700">Chargement...</p>
    </div>
  </div>

  <!-- Modal Container -->
  <div id="modal-container" class="fixed inset-0 z-40 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
      <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
      <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
      <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
        <!-- Modal content will be injected here -->
      </div>
    </div>
  </div>

  <script>
document.addEventListener('DOMContentLoaded', function() {
  const flashMessages = document.querySelectorAll('.flash-message');
  const container = document.getElementById('flash-messages');
  
  if (flashMessages.length === 0 && container) {
    container.remove();
    return;
  }
  
  // Ajouter l'overlay si des messages existent
  if (container) {
    const overlay = document.createElement('div');
    overlay.className = 'fixed inset-0 bg-black/50 transition-opacity duration-300';
    overlay.style.opacity = '0';
    container.insertBefore(overlay, container.firstChild);
    
    // Faire apparaître l'overlay
    setTimeout(() => {
      overlay.style.opacity = '1';
    }, 10);
  }
  
  // Initialiser les messages
  setTimeout(() => {
    flashMessages.forEach(msg => {
      msg.classList.remove('opacity-0', 'scale-95');
      
      const autoClose = msg.dataset.autoclose === 'true';
      const closeBtns = msg.querySelectorAll('.flash-close-btn');
      
      closeBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          closeMessage(msg);
        });
      });
      
      // Fermer en cliquant sur l'overlay
      if (overlay) {
        overlay.addEventListener('click', () => closeMessage(msg));
      }
      
      if (autoClose) {
        const progressBar = msg.querySelector('.flash-progress-bar');
        if (progressBar) {
          progressBar.style.transition = 'width 4.5s linear';
          setTimeout(() => {
            progressBar.style.width = '100%';
          }, 10);
        }
        
        setTimeout(() => {
          closeMessage(msg);
        }, 5000);
      }
    });
  }, 100);
  
  function closeMessage(message) {
    if (message.classList.contains('exiting')) return;
    
    message.classList.add('exiting');
    message.style.pointerEvents = 'none';
    
    // Faire disparaître l'overlay
    if (overlay) {
      overlay.style.opacity = '0';
    }
    
    setTimeout(() => {
      if (message.parentNode) {
        message.parentNode.removeChild(message);
      }
      
      // Supprimer le container si plus de messages
      const remainingMessages = container.querySelectorAll('.flash-message:not(.exiting)');
      if (remainingMessages.length === 0 && container) {
        setTimeout(() => {
          container.remove();
        }, 300);
      }
    }, 250);
  }
  
  // Empêcher la fermeture en cliquant sur le message lui-même
  flashMessages.forEach(msg => {
    msg.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  });
});
</script>
  <!-- Mobile Optimizations Script -->
  <script>
    // Mobile optimizations
    document.addEventListener('DOMContentLoaded', function() {
      // Prevent pinch zoom on iOS
      document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
      });
      
      // Fix viewport height on mobile
      function setVH() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      }
      
      setVH();
      window.addEventListener('resize', setVH);
      window.addEventListener('orientationchange', setVH);
      
      // Add touch feedback to buttons
      document.querySelectorAll('button, a').forEach(el => {
        el.classList.add('touch-target');
        
        // Add ripple effect on touch
        el.addEventListener('touchstart', function(e) {
          this.classList.add('scale-95');
        });
        
        el.addEventListener('touchend', function() {
          this.classList.remove('scale-95');
        });
      });
      
      // Better scroll for iOS
      if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
      }
      
      // Handle keyboard appearance on iOS
      let viewport = document.querySelector("meta[name=viewport]");
      window.addEventListener('focusin', function() {
        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0');
      });
      
      window.addEventListener('focusout', function() {
        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes');
      });
    });
    
    // Show loading overlay
    function showLoading(message = 'Chargement...') {
      const overlay = document.getElementById('loading-overlay');
      if (overlay) {
        overlay.querySelector('p').textContent = message;
        overlay.classList.remove('hidden');
      }
    }
    
    // Hide loading overlay
    function hideLoading() {
      const overlay = document.getElementById('loading-overlay');
      if (overlay) {
        overlay.classList.add('hidden');
      }
    }
    
    // Show notification
    function showNotification(message, type = 'info', duration = 5000) {
      const container = document.getElementById('notifications');
      if (!container) return;
      
      const notification = document.createElement('div');
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-green-500'
      };
      
      notification.className = `${colors[type] || colors.info} text-white px-4 py-3 rounded-lg shadow-lg flex items-center justify-between transform translate-x-full transition-transform duration-300`;
      notification.innerHTML = `
        <div class="flex items-center">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} mr-2"></i>
          <span class="text-sm">${message}</span>
        </div>
        <button onclick="this.parentElement.remove()" class="ml-4 text-white/80 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      container.appendChild(notification);
      
      // Slide in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 10);
      
      // Auto remove
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
      }, duration);
    }
    
    // Detect mobile device
    function isMobile() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }
    
    // Detect iOS
    function isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    }
    
    // Handle back button on mobile
    if (isMobile()) {
      let backButtonPressed = false;
      
      window.addEventListener('popstate', function() {
        if (!backButtonPressed) {
          backButtonPressed = true;
          showNotification('Appuyez à nouveau pour quitter', 'info', 2000);
          
          setTimeout(() => {
            backButtonPressed = false;
          }, 2000);
        } else {
          // Actually exit
          if (isIOS()) {
            window.location.href = 'about:blank';
          }
        }
      });
    }
  </script>
  <script>
document.addEventListener('DOMContentLoaded', function() {
    // Éléments du menu mobile
    const openMobileMenuBtn = document.getElementById('openMobileMenu');
    const mobileMenu = document.getElementById('mobileMenu');
    const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
    
    // Vérifier que les éléments existent
    if (!openMobileMenuBtn || !mobileMenu || !mobileMenuOverlay) {
        console.log('Éléments du menu mobile non trouvés');
        return;
    }
    
    // Ouvrir le menu mobile
    openMobileMenuBtn.addEventListener('click', () => {
        console.log('Ouverture du menu mobile');
        mobileMenuOverlay.classList.remove('hidden');
        mobileMenu.classList.remove('-translate-x-full');
        
        // Empêcher le défilement du body
        document.body.style.overflow = 'hidden';
    });
    
    // Fermer le menu mobile
    function closeMobileMenu() {
        console.log('Fermeture du menu mobile');
        mobileMenu.classList.add('-translate-x-full');
        mobileMenuOverlay.classList.add('hidden');
        
        // Restaurer le défilement du body
        document.body.style.overflow = '';
    }
    
    // Fermer avec l'overlay
    mobileMenuOverlay.addEventListener('click', closeMobileMenu);
    
    // Fermer avec la touche Échap
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !mobileMenu.classList.contains('-translate-x-full')) {
            closeMobileMenu();
        }
    });
    
    // Fermer en cliquant sur un lien (optionnel)
    const mobileMenuLinks = mobileMenu.querySelectorAll('a');
    mobileMenuLinks.forEach(link => {
        link.addEventListener('click', () => {
            setTimeout(closeMobileMenu, 300); // Petite attente pour l'animation
        });
    });
    
    // Année courante pour le footer
    const yearElements = document.querySelectorAll('#year, #year2');
    const currentYear = new Date().getFullYear();
    yearElements.forEach(element => {
        if (element) {
            element.textContent = currentYear;
        }
    });
});
</script>
</body>

  {% include 'dashboard/links/_js.html.twig' %}
  {% block javascripts %}{% endblock %}
</html>